@page "/register"
@using SmartLearn.Blazor.Services
@inject AuthService AuthService
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime

<PageTitle>Register - SmartLearn AI</PageTitle>

<MudContainer MaxWidth="MaxWidth.Small" Class="mt-8">
    <MudCard>
        <MudCardContent>
            <MudForm @ref="form" Model="@model" @onsubmit="OnSubmit">
                <MudText Typo="Typo.h4" Align="Align.Center" Class="mb-4">
                    Join SmartLearn AI
                </MudText>
                
                <MudTextField 
                    @bind-Value="model.FirstName"
                    Label="First Name"
                    Variant="Variant.Outlined"
                    Required="true"
                    RequiredError="First name is required"
                    Class="mb-4" />
                
                <MudTextField 
                    @bind-Value="model.LastName"
                    Label="Last Name"
                    Variant="Variant.Outlined"
                    Required="true"
                    RequiredError="Last name is required"
                    Class="mb-4" />
                
                <MudTextField 
                    @bind-Value="model.Email"
                    Label="Email"
                    Variant="Variant.Outlined"
                    InputType="InputType.Email"
                    Required="true"
                    RequiredError="Email is required"
                    Class="mb-4" />
                
                <MudTextField 
                    @bind-Value="model.Password"
                    Label="Password"
                    Variant="Variant.Outlined"
                    InputType="InputType.Password"
                    Required="true"
                    RequiredError="Password is required"
                    Class="mb-4" />
                
                <MudButton 
                    ButtonType="ButtonType.Submit" 
                    Variant="Variant.Filled" 
                    Color="Color.Primary" 
                    FullWidth="true"
                    Class="mb-4">
                    Register
                </MudButton>
                
                <MudText Align="Align.Center">
                    Already have an account? 
                    <MudLink Href="/login">Login here</MudLink>
                </MudText>
            </MudForm>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private MudForm form;
    private RegisterDto model = new();

    private async Task OnSubmit()
    {
        if (form.IsValid)
        {
            var success = await AuthService.RegisterAsync(model);
            
            if (success)
            {
                Navigation.NavigateTo("/dashboard");
            }
            else
            {
                await JSRuntime.InvokeVoidAsync("alert", "Registration failed. Please try again.");
            }
        }
    }
}